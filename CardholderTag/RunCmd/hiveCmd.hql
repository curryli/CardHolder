卡MD5，发卡机构，发卡机构名称，卡等级， 近6月广义消费金额，近6月中有广义消费的月份数目， 近6月广义月均消费金额
		sb.append(card_num+Constant.separator_1);
		sb.append(card_md5+Constant.separator_1);									//MD5
		sb.append(iss_ins_code+Constant.separator_1);								//发卡机构代码
		sb.append(iss_ins_name+Constant.separator_1);								//发卡机构名称
		sb.append(card_level+Constant.separator_1);									//卡等级
		sb.append(cs_trx_amt_L6M+Constant.separator_1);
		sb.append(T_No_Trx_M_L6M+Constant.separator_1);
		sb.append(avg_amt_L6M);
 
求月消费平均金额的百分位数 
 
1、创建外部表  如果不用外部表，drop table的时候也罢数据给删掉了，很烦
CREATE external TABLE IF NOT EXISTS consumptionOut1_xrli(
card_num string,
card_md5 string,
iss_ins_code string,
iss_ins_name string, 
card_level string,
cs_trx_amt_L6M double,
T_No_Trx_M_L6M int,
avg_amt_L6M double
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
stored as textfile
location 'hdfs://nameservice1/user/hdanaly/xrli/CardholderTag/consumption_out';

 


#select percentile_approx(avg_amt_L6M,0.1) from consumptionOut1_xrli where avg_amt_L6M is not null;

2、计算百分位数
select percentile_approx(avg_amt_L6M, array(0.01,0.02,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.1,0.11,0.12,0.13,0.14,0.15,0.16,0.17,0.18,0.19,0.2,
0.21,0.22,0.23,0.24,0.25,0.26,0.27,0.28,0.29,0.3,0.31,0.32,0.33,0.34,0.35,0.36,0.37,0.38,0.39,0.4,
0.41,0.42,0.43,0.44,0.45,0.46,0.47,0.48,0.49,0.5,0.51,0.52,0.53,0.54,0.55,0.56,0.57,0.58,0.59,0.6,
0.61,0.62,0.63,0.64,0.65,0.66,0.67,0.68,0.69,0.7,0.71,0.72,0.73,0.74,0.75,0.76,0.77,0.78,0.79,0.8,
0.81,0.82,0.83,0.84,0.85,0.86,0.87,0.88,0.89,0.9,0.91,0.92,0.93,0.94,0.95,0.96,0.97,0.98,0.99)) from consumptionOut1_xrli where avg_amt_L6M is not null;



[-2126.010257032513,-2089.8292267548813,-2053.6481964772493,-2017.4671661996172,-1981.2861359219853,-1945.1051056443534,-1908.9240753667214,-1872.7430450890895,-1836.5620148114576,-1800.3809845338255,-1764.1999542561937,-1728.0189239785618,-1691.8378937009297,-1655.6568634232976,-1619.475833145666,-1583.294802868034,-1547.1137725904018,-1510.93274231277,-1474.751712035138,-1438.570681757506,-1402.3896514798741,-1366.2086212022423,-1330.0275909246102,-1293.8465606469783,-1257.6655303693465,-1221.4845000917144,-1185.3034698140823,-1149.1224395364502,-1112.9414092588186,-1076.7603789811867,-1040.5793487035546,-1004.3983184259228,-968.2172881482907,-932.0362578706586,-895.8552275930267,-859.6741973153948,-823.493167037763,-787.3121367601309,-751.131106482499,-714.9500762048672,-678.7690459272351,-642.588015649603,-606.4069853719711,-570.2259550943393,-534.0449248167074,-497.8638945390753,-461.6828642614432,-425.50183398381137,-389.3208037061795,-353.1397734285474,-316.95874315091555,-280.7777128732837,-244.59668259565183,-208.4156523180195,-172.23462204038765,-136.05359176275556,-99.87256148512415,-63.69153120749206,-27.510500929859973,8.670529347772117,44.85155962540375,81.03258990303584,117.21362018066793,153.39465045830002,189.57568073593166,225.75671101356374,261.93774129119583,319.64659626453476,508.76094634660024,697.8752964286709,886.9896465107398,1076.103996592809,1265.2183466748777,1454.3326967569467,1643.4470468390157,1832.5613969210847,2021.6757470031534,2262.113727278055,2654.441532369468,3046.7693374608807,3439.0971425522976,3850.0753769020384,4284.60136136359,4719.127345825137,5281.623922711046,6017.908915675751,6750.404327168298,7481.851204659661,8424.391411354138,9398.225081268607,11240.662530947737,13218.054918716767,15351.812607451888,19035.66501168138,22898.99327675366,29023.97199134363,39851.73876321124,58160.3380337352,109895.64263117102]
Time taken: 1475.469 seconds, Fetched: 1 row(s)